<div class="order-group container">
  <div class="col-2 title text-center pt-4">
    <h5 class="bg-light">注文履歴詳細</h5>
  </div>
  
  <div>
    <p>購入者</p>
    <%= link_to @order.customer.name, admin_customer_path %>
  </div>
  <div>
    <p>注文日</p>
    <%= @order.created_at %>
  </div>
  <div>
    <p>配送先</p>
    <%= @order.address %><br><%= @order.name %>
  </div>
  <div>
    <p>支払方法</p>
    <%= @order.payment_method %>
  </div>
  <div>
    <p>注文ステータス</p>
    <%= form_with model: @order, url: admin_order_path(@order), method: :patch do |f| %>
      <%= f.select :status, options_for_select(Order.statuses.keys, @order.status) %>
      <%= f.submit "更新", class: "btn btn-sm btn-success" %>
    <% end %>
  </div>
  
  <table class="table">
    <thead>
      <tr>
        <th>商品名</th>
        <th>単価（税込）</th>
        <th>数量</th>
        <th>小計</th>
        <th>製作ステータス</th>
      </tr>
    </thead>
    <tbody>
      <% @order.order_items.each do |order_item| %>
        <tr>
          <td><%= order_item.item.name %></td>
          <td><%= order_item.price.to_s(:delimited) %></td>
          <td><%= order_item.amount %></td>
          <td><%= (order_item.price * order_item.amount).to_s(:delimited) %></td>
          <td>
            <%= form_with model: order_item, url: admin_order_item_path(@order, order_item), method: :patch do |f| %>
              <%= f.select :making_status, options_for_select(OrderItem.making_statuses.keys, f.object.making_status) %>
              <%= f.submit "更新", class: "btn btn-sm btn-success" %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div>
    <b>商品合計</b>
    <% total = 0 %>
    <% @order.order_items.each do |order_item| %>
      <% subtotal = order_item.price * order_item.amount %>
      <% total += subtotal %>
    <% end %>
    <%= total.to_s(:delimited) %>円
  </div>
  <div>
    <b>送料</b> <%= @shipping_cost %>円
  </div>
  <div>
    <% total_payment = 0 %>
    <% total_payment += total += @shipping_cost %>
    <b>請求金額合計 <%= total_payment.to_s(:delimited) %>円</b>
  </div>
  

</div>
